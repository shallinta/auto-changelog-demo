# auto-changelog-demo

A project demo which configs auto generation of changelogs when commiting codes.

## Start

```sh
# eg. preparations
npm install

# Add a new file or modify something.
git add .
git commit -m 'feat: test change'

# Modify a commit
git commit --amend
```

## Notes

### About `postchangelog` hook handler of `standard-version`

```json
"standard-version": {
    "scripts": {
        "postchangelog": "replace '((### \\d.\\d.\\d[^\n]*\n)(?!\nBy))' '$1\nBy @'$(git config user.name) CHANGELOG.md"
    }
}
```

This hook handler inserts committer's git username after the heading of the version generated by its commit.

Can also use the following script to replace git username with the front part of git email:

```json
"standard-version": {
    "scripts": {
        "postchangelog": "replace '((### \\d.\\d.\\d[^\n]*\n)(?!\nBy))' '$1\nBy @'$(echo $(git config user.email) | cut -d \\@ -f 1) CHANGELOG.md"
    }
}
```

In real-world project, by taking use of this hook handler, you can replace the JIRA id part in the commit message with a full link to a JIRA page. Here is an example:

```json
"standard-version": {
    "scripts": {
      "postchangelog": "replace '((?<![/a-zA-Z])[a-zA-Z]{1,8}-\\d{1,8}(?!\\d*\\]\\())' '[$1](https://jira.mycompanydomain.com/issue/$1)' CHANGELOG.md"
    }
}
```

After this, the CHANGELOG file which is generated and updated by `standard-version` will contains a change information with a link to the JIRA page that indicates to this change. It really works and it's a good way to manage and record project iteration and product requirements.

### About `version-check`

A version check action happends at `prebump` hook handler of `standard-version`. This is a necessary step to avoid version gap and generating multiple change log records before one "push" when doing more than one commits or modifying commits through `git commit --amend`.

There is a script to compare current version at package.json with version at remote repository's package.json. If the current version is already higher than the remote one, keep the current version in package.json and merge the change logs.

The way to get remote version now is to read version field of remote repository's package.json. If you have a server api to get the online production version, you can modify the script code at `.husky/scripts/version-check.js`. But remember to use synchronous way to send the api request. The `xd-sycnhttp` is a npm package which helps sending a synchronous request in node.

## Contributing

[How to contribute to this?](CONTRIBUTING.md)

## Recently changes

See the [change log](CHANGELOG.md).

## License

[MIT](LICENSE)
